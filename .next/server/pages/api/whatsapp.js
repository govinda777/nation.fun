"use strict";(()=>{var e={};e.id=874,e.ids=[874],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9648:e=>{e.exports=import("axios")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},6826:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{config:()=>d,default:()=>u,routeModule:()=>p});var r=a(1802),n=a(7153),o=a(6249),i=a(8517),c=e([i]);i=(c.then?(await c)():c)[0];let u=(0,o.l)(i,"default"),d=(0,o.l)(i,"config"),p=new r.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/whatsapp",pathname:"/api/whatsapp",bundlePath:"",filename:""},userland:i});s()}catch(e){s(e)}})},8517:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{default:()=>i});var r=a(3840),n=a(715),o=e([n]);async function i(e,t){if("GET"===e.method){let a=process.env.WHATSAPP_VERIFY_TOKEN,s=e.query["hub.mode"],r=e.query["hub.verify_token"],n=e.query["hub.challenge"];"subscribe"===s&&r===a?t.status(200).send(n):t.status(403).end()}else if("POST"===e.method)try{if(!(0,r.T)(e))return t.status(401).send("Unauthorized");await (0,n.X)(e.body),t.status(200).send("OK")}catch(e){console.error("Error processing WhatsApp webhook:",e),t.status(500).send("Internal Server Error")}else t.setHeader("Allow",["GET","POST"]),t.status(405).end(`Method ${e.method} Not Allowed`)}n=(o.then?(await o)():o)[0],s()}catch(e){s(e)}})},9352:(e,t,a)=>{a.d(t,{Z:()=>r});class s{async getAgentResponse(e){return`You said: ${e}`}}let r=new s},4009:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.d(t,{Z:()=>i});var r=a(9648),n=e([r]);r=(n.then?(await n)():n)[0];class o{constructor(){this.baseURL=`https://graph.facebook.com/v19.0/${process.env.WHATSAPP_PHONE_ID}`,this.axiosInstance=r.default.create({baseURL:this.baseURL,headers:{Authorization:`Bearer ${process.env.WHATSAPP_ACCESS_TOKEN}`,"Content-Type":"application/json"}})}async sendMessage(e,t){try{return(await this.axiosInstance.post("/messages",{messaging_product:"whatsapp",to:e,text:{body:t}})).data}catch(e){throw console.error("Error sending WhatsApp message:",e.response.data),Error("Failed to send WhatsApp message")}}}let i=new o;s()}catch(e){s(e)}})},715:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.d(t,{X:()=>i});var r=a(4009),n=a(9352),o=e([r]);async function i(e){try{let t=e.entry?.[0]?.changes?.[0]?.value?.messages?.[0];if(t?.type==="text"){let e=t.from,a=t.text.body,s=await n.Z.getAgentResponse(a);await r.Z.sendMessage(e,s)}}catch(e){console.error("Error processing WhatsApp message:",e)}}r=(o.then?(await o)():o)[0],s()}catch(e){s(e)}})},3840:(e,t,a)=>{a.d(t,{T:()=>n});let s=require("crypto");var r=a.n(s);function n(e){let t=e.headers["x-hub-signature-256"];if(!t)return!1;let a=JSON.stringify(e.body),s=r().createHmac("sha256",process.env.WHATSAPP_APP_SECRET);s.update(a);let n=`sha256=${s.digest("hex")}`;return r().timingSafeEqual(Buffer.from(t),Buffer.from(n))}},7153:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},1802:(e,t,a)=>{e.exports=a(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=t(t.s=6826);module.exports=a})();