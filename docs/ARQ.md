# ğŸ—ï¸ DocumentaÃ§Ã£o TÃ©cnica - Arquitetura Completa nation.fun

**VersÃ£o:** 2.0 (Production-Ready)  
**Data:** 29 de novembro de 2025  
**Status:** âœ… Pronto para ImplementaÃ§Ã£o  
**Ambiente:** Next.js 14+, TypeScript, Vercel, GitHub  

---

## ğŸ“‘ Ãndice Executivo

1. [VisÃ£o Geral do Projeto](#visÃ£o-geral-do-projeto)
2. [Arquitetura Macro](#arquitetura-macro)
3. [Estrutura de DiretÃ³rios](#estrutura-de-diretÃ³rios)
4. [Componentes Principais](#componentes-principais)
5. [Fluxo de Dados](#fluxo-de-dados)
6. [DecisÃµes ArquitetÃ´nicas](#decisÃµes-arquitetÃ´nicas)
7. [Stack TecnolÃ³gico](#stack-tecnolÃ³gico)
8. [SeguranÃ§a & Compliance](#seguranÃ§a--compliance)
9. [Performance & OtimizaÃ§Ãµes](#performance--otimizaÃ§Ãµes)
10. [DevOps & CI/CD](#devops--cicd)
11. [Testes & Qualidade](#testes--qualidade)
12. [DocumentaÃ§Ã£o API](#documentaÃ§Ã£o-api)

---

## ğŸ¯ VisÃ£o Geral do Projeto

### PropÃ³sito
O **nation.fun** Ã© uma aplicaÃ§Ã£o web moderna que integra com a plataforma Nation, permitindo interaÃ§Ãµes seguras atravÃ©s de um agente de chat inteligente.

### Escopo Atual
- Interface moderna com React/Next.js
- IntegraÃ§Ã£o segura com Nation API
- Chat baseado em IA com context awareness
- Arquitetura serverless para escalabilidade
- Compliance com padrÃµes de seguranÃ§a OWASP

### KPIs & Objetivos
```
Performance:
â”œâ”€ Tempo de resposta API: < 500ms (p95)
â”œâ”€ LatÃªncia de chat: < 1s (p95)
â”œâ”€ Uptime: 99.9%
â””â”€ Score Lighthouse: >= 90

SeguranÃ§a:
â”œâ”€ Zero exposiÃ§Ã£o de tokens
â”œâ”€ Rate limiting: 10 req/min por IP
â”œâ”€ Audit logging: 100% das operaÃ§Ãµes
â””â”€ OWASP A01:2021 Compliance

Escalabilidade:
â”œâ”€ Suportar 1000 req/s concurrent
â”œâ”€ Auto-scaling automÃ¡tico
â”œâ”€ Database connections pooled
â””â”€ Cache multi-layer
```

---

## ğŸ›ï¸ Arquitetura Macro

### Diagrama Arquitetural (Completo)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CAMADA DE APRESENTAÃ‡ÃƒO (Browser)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ React App (Next.js Frontend)                            â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â€¢ Components/ - Componentes React reutilizÃ¡veis         â”‚   â”‚
â”‚  â”‚ â€¢ Hooks/ - Custom hooks para lÃ³gica de negÃ³cio          â”‚   â”‚
â”‚  â”‚ â€¢ Stores/ - State management (Zustand/Redux)            â”‚   â”‚
â”‚  â”‚ â€¢ utils/ - FunÃ§Ãµes utilitÃ¡rias                          â”‚   â”‚
â”‚  â”‚ â€¢ styles/ - CSS/Tailwind                                â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚ âœ… SEM credenciais de API                               â”‚   â”‚
â”‚  â”‚ âœ… SEM tokens sensÃ­veis                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â–²                                      â”‚
â”‚                            â”‚ HTTPS                                â”‚
â”‚                            â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ API Client (`/lib/api-client.ts`)                       â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â€¢ Chamadas para /api/chat (sem token)                   â”‚   â”‚
â”‚  â”‚ â€¢ Retry logic & backoff exponencial                     â”‚   â”‚
â”‚  â”‚ â€¢ Error handling & user feedback                        â”‚   â”‚
â”‚  â”‚ â€¢ Request/Response interceptors                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                               â”‚ POST /api/chat\n                               â”‚ { message: string }\n                               â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                 CAMADA DE API GATEWAY (Backend)                  â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                                   â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚ Next.js API Routes (Vercel Serverless)                  â”‚   â”‚\nâ”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚\nâ”‚  â”‚ /api/chat/route.ts                                       â”‚   â”‚\nâ”‚  â”‚ â”œâ”€ ValidaÃ§Ã£o de request (headers, body)                â”‚   â”‚\nâ”‚  â”‚ â”œâ”€ Authentication & Authorization                      â”‚   â”‚\nâ”‚  â”‚ â”œâ”€ Rate limiting (token bucket algorithm)              â”‚   â”‚\nâ”‚  â”‚ â”œâ”€ Input sanitization                                  â”‚   â”‚\nâ”‚  â”‚ â”œâ”€ Chamada segura ao Nation com token protegido         â”‚   â”‚\nâ”‚  â”‚ â”œâ”€ Processing de resposta                              â”‚   â”‚\nâ”‚  â”‚ â”œâ”€ Audit logging (timestamp, IP, action)               â”‚   â”‚\nâ”‚  â”‚ â””â”€ Error handling & observability                      â”‚   â”‚\nâ”‚  â”‚                                                          â”‚   â”‚\nâ”‚  â”‚ ğŸ” process.env.NATION_TOKEN (SEM exposiÃ§Ã£o)            â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚                            â–²                                      â”‚\nâ”‚                            â”‚ HTTPS (B2B)                          â”‚\nâ”‚                            â–¼                                      â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚ Middleware & Utilities                                  â”‚   â”‚\nâ”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚\nâ”‚  â”‚ â€¢ Auth middleware (validaÃ§Ã£o de origem)                â”‚   â”‚\nâ”‚  â”‚ â€¢ Rate limiter (Redis ou in-memory)                    â”‚   â”‚\nâ”‚  â”‚ â€¢ Logger (estruturado, ELK stack)                      â”‚   â”‚\nâ”‚  â”‚ â€¢ Metrics collector (Prometheus format)                â”‚   â”‚\nâ”‚  â”‚ â€¢ Error tracker (Sentry integration)                   â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                               â”‚ HTTPS (Backend-to-Backend)\n                               â”‚ Authorization: Bearer NATION_TOKEN\n                               â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚               CAMADA DE SERVIÃ‡OS EXTERNOS                         â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                                   â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚\nâ”‚  â”‚  Nation API          â”‚  â”‚  Observability       â”‚             â”‚\nâ”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚\nâ”‚  â”‚ â€¢ Chat endpoint      â”‚  â”‚ â€¢ Sentry (errors)   â”‚             â”‚\nâ”‚  â”‚ â€¢ Auth validation    â”‚  â”‚ â€¢ Datadog (metrics) â”‚             â”‚\nâ”‚  â”‚ â€¢ Context management â”‚  â”‚ â€¢ ELK (logs)        â”‚             â”‚\nâ”‚  â”‚ â€¢ Rate limits (ext)  â”‚  â”‚ â€¢ Grafana (dashboards)           â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚\nâ”‚                                                                   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```

### Componentes por Camada

**ğŸ¨ Presentation Layer (Frontend)**
- React Components com TypeScript
- Zustand/Redux para state management
- React Query para data fetching
- Tailwind CSS + custom themes

**ğŸ” Security Layer (Middleware)**
- JWT validation (se aplicÃ¡vel)
- CORS policy enforcement
- Rate limiting (token bucket)
- Input validation & sanitization

**âš™ï¸ Business Logic Layer (API Routes)**
- OrchestraÃ§Ã£o de requisiÃ§Ãµes
- Processamento de dados
- Cache management
- Error handling

**ğŸŒ Integration Layer (External APIs)**
- Nation API client
- Observability providers
- Database connections
- File storage services

---

## ğŸ“ Estrutura de DiretÃ³rios

```
nation-fun/
â”‚
â”œâ”€â”€ ğŸ“‚ app/                                 # Next.js App Router
â”‚   â”œâ”€â”€ ğŸ“„ layout.tsx                      # Root layout com providers
â”‚   â”œâ”€â”€ ğŸ“„ page.tsx                        # PÃ¡gina inicial
â”‚   â”œâ”€â”€ ğŸ“„ globals.css                     # Estilos globais
â”‚   â”œâ”€â”€ ğŸ“‚ (auth)/                         # Grupo de rotas auth (layout privado)
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ login/
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ page.tsx
â”‚   â”‚   â””â”€â”€ ğŸ“‚ register/
â”‚   â”‚       â””â”€â”€ ğŸ“„ page.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ (dashboard)/                    # Grupo de rotas dashboard (protegido)
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ chat/
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ page.tsx               # Chat interface
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“‚ [conversationId]/
â”‚   â”‚   â”‚       â””â”€â”€ ğŸ“„ page.tsx           # Conversa individual\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“‚ settings/\nâ”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ page.tsx               # ConfiguraÃ§Ãµes do usuÃ¡rio\nâ”‚   â”‚   â””â”€â”€ ğŸ“‚ history/\nâ”‚   â”‚       â””â”€â”€ ğŸ“„ page.tsx               # HistÃ³rico de chats\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ ğŸ“‚ api/                            # API Routes (Backend)\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“‚ chat/\nâ”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ route.ts               # POST /api/chat (main endpoint)\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“‚ auth/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ route.ts               # Auth operations\nâ”‚   â”‚   â”‚   â””â”€â”€ ğŸ“‚ [...nextauth]/\nâ”‚   â”‚   â”‚       â””â”€â”€ ğŸ“„ route.ts           # NextAuth.js handler\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“‚ health/\nâ”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ route.ts               # Health check\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â””â”€â”€ ğŸ“‚ admin/\nâ”‚   â”‚       â””â”€â”€ ğŸ“„ route.ts               # Admin operations (protegido)\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ ğŸ“‚ error.tsx                      # Error page\nâ”‚   â”œâ”€â”€ ğŸ“‚ loading.tsx                    # Loading skeleton\nâ”‚   â””â”€â”€ ğŸ“‚ not-found.tsx                  # 404 page\nâ”‚\nâ”œâ”€â”€ ğŸ“‚ components/                         # React Components (reutilizÃ¡veis)\nâ”‚   â”œâ”€â”€ ğŸ“‚ ui/                            # UI base components\nâ”‚   â”‚   â”œâ”€â”€ Button.tsx\nâ”‚   â”‚   â”œâ”€â”€ Input.tsx\nâ”‚   â”‚   â”œâ”€â”€ Card.tsx\nâ”‚   â”‚   â”œâ”€â”€ Modal.tsx\nâ”‚   â”‚   â””â”€â”€ ...\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ ğŸ“‚ chat/                          # Chat-specific components\nâ”‚   â”‚   â”œâ”€â”€ ChatWindow.tsx\nâ”‚   â”‚   â”œâ”€â”€ MessageList.tsx\nâ”‚   â”‚   â”œâ”€â”€ InputArea.tsx\nâ”‚   â”‚   â””â”€â”€ MessageBubble.tsx\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ ğŸ“‚ layout/                        # Layout components\nâ”‚   â”‚   â”œâ”€â”€ Header.tsx\nâ”‚   â”‚   â”œâ”€â”€ Sidebar.tsx\nâ”‚   â”‚   â””â”€â”€ Footer.tsx\nâ”‚   â”‚\nâ”‚   â””â”€â”€ ğŸ“‚ common/                        # Componentes comuns\nâ”‚       â”œâ”€â”€ LoadingSpinner.tsx\nâ”‚       â”œâ”€â”€ ErrorBoundary.tsx\nâ”‚       â””â”€â”€ Toast.tsx\nâ”‚\nâ”œâ”€â”€ ğŸ“‚ lib/                                # UtilitÃ¡rios e clientes\nâ”‚   â”œâ”€â”€ ğŸ“„ api-client.ts                  # HTTP client com retry logic\nâ”‚   â”œâ”€â”€ ğŸ“„ nation-client.ts               # Wrapper Nation API (backend)\nâ”‚   â”œâ”€â”€ ğŸ“„ auth.ts                        # Auth utilities\nâ”‚   â”œâ”€â”€ ğŸ“„ db.ts                          # Database client (se aplicÃ¡vel)\nâ”‚   â”œâ”€â”€ ğŸ“„ validators.ts                  # Input validation schemas\nâ”‚   â”œâ”€â”€ ğŸ“„ errors.ts                      # Custom error classes\nâ”‚   â”œâ”€â”€ ğŸ“„ logger.ts                      # Structured logging\nâ”‚   â”œâ”€â”€ ğŸ“„ rate-limiter.ts               # Rate limiting implementation\nâ”‚   â””â”€â”€ ğŸ“„ cache.ts                       # Cache utilities\nâ”‚\nâ”œâ”€â”€ ğŸ“‚ hooks/                              # Custom React Hooks\nâ”‚   â”œâ”€â”€ ğŸ“„ useChat.ts                     # Chat logic hook\nâ”‚   â”œâ”€â”€ ğŸ“„ useAuth.ts                     # Auth state hook\nâ”‚   â”œâ”€â”€ ğŸ“„ useFetch.ts                    # Data fetching hook\nâ”‚   â””â”€â”€ ğŸ“„ useLocalStorage.ts             # LocalStorage with sync\nâ”‚\nâ”œâ”€â”€ ğŸ“‚ stores/                             # State Management (Zustand)\nâ”‚   â”œâ”€â”€ ğŸ“„ chatStore.ts                   # Chat state\nâ”‚   â”œâ”€â”€ ğŸ“„ authStore.ts                   # Auth state\nâ”‚   â””â”€â”€ ğŸ“„ uiStore.ts                     # UI state\nâ”‚\nâ”œâ”€â”€ ğŸ“‚ types/                              # TypeScript type definitions\nâ”‚   â”œâ”€â”€ ğŸ“„ index.ts                       # Re-exports comuns\nâ”‚   â”œâ”€â”€ ğŸ“„ api.ts                         # API types\nâ”‚   â”œâ”€â”€ ğŸ“„ chat.ts                        # Chat domain types\nâ”‚   â”œâ”€â”€ ğŸ“„ user.ts                        # User types\nâ”‚   â””â”€â”€ ğŸ“„ errors.ts                      # Error types\nâ”‚\nâ”œâ”€â”€ ğŸ“‚ middleware/                         # Next.js middleware\nâ”‚   â”œâ”€â”€ ğŸ“„ auth.ts                        # Auth middleware\nâ”‚   â”œâ”€â”€ ğŸ“„ rateLimit.ts                   # Rate limit middleware\nâ”‚   â””â”€â”€ ğŸ“„ logging.ts                     # Logging middleware\nâ”‚\nâ”œâ”€â”€ ğŸ“‚ utils/                              # Utility functions\nâ”‚   â”œâ”€â”€ ğŸ“„ strings.ts                     # String helpers\nâ”‚   â”œâ”€â”€ ğŸ“„ dates.ts                       # Date helpers\nâ”‚   â”œâ”€â”€ ğŸ“„ formatting.ts                  # Format utilities\nâ”‚   â””â”€â”€ ğŸ“„ arrays.ts                      # Array helpers\nâ”‚\nâ”œâ”€â”€ ğŸ“‚ public/                             # Static assets\nâ”‚   â”œâ”€â”€ ğŸ“‚ images/\nâ”‚   â”œâ”€â”€ ğŸ“‚ icons/\nâ”‚   â””â”€â”€ ğŸ“‚ fonts/\nâ”‚\nâ”œâ”€â”€ ğŸ“‚ __tests__/                          # Tests\nâ”‚   â”œâ”€â”€ ğŸ“‚ api/\nâ”‚   â”‚   â””â”€â”€ ğŸ“„ chat.test.ts\nâ”‚   â”œâ”€â”€ ğŸ“‚ components/\nâ”‚   â”‚   â””â”€â”€ ğŸ“„ ChatWindow.test.tsx\nâ”‚   â”œâ”€â”€ ğŸ“‚ hooks/\nâ”‚   â”‚   â””â”€â”€ ğŸ“„ useChat.test.ts\nâ”‚   â””â”€â”€ ğŸ“‚ lib/\nâ”‚       â””â”€â”€ ğŸ“„ validators.test.ts\nâ”‚\nâ”œâ”€â”€ ğŸ“‚ features/                           # BDD Feature files\nâ”‚   â”œâ”€â”€ ğŸ“„ chat-messaging.feature\nâ”‚   â”œâ”€â”€ ğŸ“„ authentication.feature\nâ”‚   â””â”€â”€ ğŸ“„ api-security.feature\nâ”‚\nâ”œâ”€â”€ ğŸ“‚ .github/                            # GitHub Actions & config\nâ”‚   â”œâ”€â”€ ğŸ“‚ workflows/\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“„ deploy.yml                # Deploy to Vercel\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“„ test.yml                  # Run tests\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“„ lint.yml                  # Linting\nâ”‚   â”‚   â””â”€â”€ ğŸ“„ security.yml              # Security checks\nâ”‚   â””â”€â”€ ğŸ“‚ ISSUE_TEMPLATE/\nâ”‚\nâ”œâ”€â”€ ğŸ“„ .env.example                        # Environment variables template\nâ”œâ”€â”€ ğŸ“„ .env.local                          # Local env (NÃƒO commitar!)\nâ”œâ”€â”€ ğŸ“„ .gitignore                          # Git ignore rules\nâ”œâ”€â”€ ğŸ“„ .eslintrc.json                      # ESLint config\nâ”œâ”€â”€ ğŸ“„ .prettierrc                         # Prettier config\nâ”œâ”€â”€ ğŸ“„ tsconfig.json                       # TypeScript config\nâ”œâ”€â”€ ğŸ“„ next.config.js                      # Next.js config\nâ”œâ”€â”€ ğŸ“„ vercel.json                         # Vercel deployment config\nâ”œâ”€â”€ ğŸ“„ jest.config.js                      # Jest test config\nâ”œâ”€â”€ ğŸ“„ package.json                        # Dependencies\nâ”œâ”€â”€ ğŸ“„ package-lock.json                   # Dependency lock\nâ”‚\nâ”œâ”€â”€ ğŸ“„ README.md                           # Project documentation\nâ”œâ”€â”€ ğŸ“„ CONTRIBUTING.md                     # Contribution guidelines\nâ”œâ”€â”€ ğŸ“„ ARCHITECTURE.md                     # This file\nâ”œâ”€â”€ ğŸ“„ SECURITY.md                         # Security policies\nâ””â”€â”€ ğŸ“„ CHANGELOG.md                        # Version history\n```

---

## âš™ï¸ Componentes Principais

### 1. **Frontend Application (`/app`)**

```typescript
// app/layout.tsx - Root layout com providers
import { ReactNode } from 'react';\nimport { Providers } from '@/components/providers';\n\nexport default function RootLayout({ children }: { children: ReactNode }) {\n  return (\n    <html lang=\"pt-BR\">\n      <head>\n        <meta charset=\"UTF-8\" />\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n      </head>\n      <body>\n        <Providers>\n          {children}\n        </Providers>\n      </body>\n    </html>\n  );\n}\n```\n\n### 2. **API Gateway (`/api/chat`)**\n\n```typescript\n// app/api/chat/route.ts - Main endpoint seguro\nimport { NextRequest, NextResponse } from 'next/server';\nimport { validateRequest } from '@/lib/validators';\nimport { checkRateLimit } from '@/lib/rate-limiter';\nimport { callNationAPI } from '@/lib/nation-client';\nimport { auditLog } from '@/lib/logger';\n\nexport async function POST(req: NextRequest) {\n  try {\n    const clientIp = req.headers.get('x-forwarded-for') || 'unknown';\n    \n    // 1. ValidaÃ§Ã£o\n    const validation = validateRequest(req);\n    if (!validation.valid) {\n      return NextResponse.json({ error: validation.error }, { status: 400 });\n    }\n    \n    // 2. Rate limiting\n    if (!checkRateLimit(clientIp)) {\n      auditLog(clientIp, 'RATE_LIMIT_EXCEEDED');\n      return NextResponse.json(\n        { error: 'Too many requests' },\n        { status: 429, headers: { 'Retry-After': '60' } }\n      );\n    }\n    \n    // 3. Parsear body\n    const { message } = await req.json();\n    if (!message || typeof message !== 'string') {\n      return NextResponse.json({ error: 'Invalid message' }, { status: 400 });\n    }\n    \n    // 4. Chamar Nation API (token protegido)\n    const result = await callNationAPI(message);\n    if (!result.success) {\n      auditLog(clientIp, 'CHAT_FAILED', { error: result.error });\n      return NextResponse.json({ error: result.error }, { status: 500 });\n    }\n    \n    // 5. Retornar resposta (sem token)\n    auditLog(clientIp, 'CHAT_SUCCESS');\n    return NextResponse.json({ success: true, data: result.data });\n    \n  } catch (error) {\n    console.error('API error:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n```\n\n### 3. **State Management (`/stores`)**\n\n```typescript\n// stores/chatStore.ts - Zustand store\nimport { create } from 'zustand';\n\ninterface Message {\n  id: string;\n  content: string;\n  role: 'user' | 'assistant';\n  timestamp: Date;\n}\n\ninterface ChatStore {\n  messages: Message[];\n  loading: boolean;\n  error: string | null;\n  addMessage: (message: Message) => void;\n  clearMessages: () => void;\n  setLoading: (loading: boolean) => void;\n  setError: (error: string | null) => void;\n}\n\nexport const useChatStore = create<ChatStore>((set) => ({\n  messages: [],\n  loading: false,\n  error: null,\n  addMessage: (message) =>\n    set((state) => ({ messages: [...state.messages, message] })),\n  clearMessages: () => set({ messages: [] }),\n  setLoading: (loading) => set({ loading }),\n  setError: (error) => set({ error }),\n}));\n```\n\n### 4. **Custom Hooks (`/hooks`)**\n\n```typescript\n// hooks/useChat.ts - Chat logic\nimport { useState, useCallback } from 'react';\nimport { useChatStore } from '@/stores/chatStore';\nimport { sendMessage as apiSendMessage } from '@/lib/api-client';\n\nexport function useChat() {\n  const { messages, addMessage, setLoading, setError } = useChatStore();\n  const [input, setInput] = useState('');\n  \n  const sendMessage = useCallback(async (content: string) => {\n    setLoading(true);\n    try {\n      const response = await apiSendMessage(content);\n      addMessage({\n        id: Date.now().toString(),\n        content,\n        role: 'user',\n        timestamp: new Date(),\n      });\n      addMessage({\n        id: (Date.now() + 1).toString(),\n        content: response.data,\n        role: 'assistant',\n        timestamp: new Date(),\n      });\n      setInput('');\n    } catch (error) {\n      setError(error instanceof Error ? error.message : 'Unknown error');\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n  \n  return { messages, sendMessage, input, setInput };\n}\n```\n\n### 5. **API Client (`/lib/api-client.ts`)**\n\n```typescript\n// lib/api-client.ts - HTTP client com retry\nimport { exponentialBackoff, maxRetries } from '@/lib/utils';\n\nexport async function sendMessage(message: string) {\n  let lastError: Error | null = null;\n  \n  for (let attempt = 0; attempt < maxRetries; attempt++) {\n    try {\n      const response = await fetch('/api/chat', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ message }),\n      });\n      \n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}`);\n      }\n      \n      return await response.json();\n      \n    } catch (error) {\n      lastError = error as Error;\n      if (attempt < maxRetries - 1) {\n        await exponentialBackoff(attempt);\n      }\n    }\n  }\n  \n  throw lastError || new Error('Max retries exceeded');\n}\n```\n\n---\n\n## ğŸ”„ Fluxo de Dados\n\n### Fluxo de Chat (End-to-End)\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   User Types Chat   â”‚\nâ”‚   \"OlÃ¡, mundo!\"     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n           â”‚\n           â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ React Component (ChatWindow.tsx)                    â”‚\nâ”‚ â€¢ Captura input de usuÃ¡rio                         â”‚\nâ”‚ â€¢ Valida comprimento (max 5000 chars)              â”‚\nâ”‚ â€¢ Emite evento de send                             â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n           â”‚\n           â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ useChat Hook                                        â”‚\nâ”‚ â€¢ Atualiza UI (adds user message to store)         â”‚\nâ”‚ â€¢ Chama API via /api/chat                          â”‚\nâ”‚ â€¢ Inicia loading state                             â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n           â”‚ POST /api/chat\n           â”‚ { message: \"OlÃ¡, mundo!\" }\n           â”‚ (SEM token)\n           â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ API Route: /api/chat (Vercel Function)             â”‚\nâ”‚ 1. Validar request (headers, body size)            â”‚\nâ”‚ 2. Check rate limit (10 req/min by IP)             â”‚\nâ”‚ 3. Sanitizar input                                 â”‚\nâ”‚ 4. Log auditoria (timestamp, IP, message length)   â”‚\nâ”‚ 5. Chamar Nation API com token protegido           â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n           â”‚ POST https://api.nation.fun/v1/chat\n           â”‚ Authorization: Bearer NATION_TOKEN\n           â”‚ { message: \"OlÃ¡, mundo!\" }\n           â”‚ (SEM exposiÃ§Ã£o ao client)\n           â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Nation API                                          â”‚\nâ”‚ â€¢ Processa mensagem                                â”‚\nâ”‚ â€¢ Busca context                                    â”‚\nâ”‚ â€¢ Gera resposta                                    â”‚\nâ”‚ â€¢ Retorna resposta JSON                            â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n           â”‚ { response: \"OlÃ¡! Como posso ajudar?\" }\n           â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ API Route: /api/chat (Processa resposta)           â”‚\nâ”‚ â€¢ Filtra dados sensÃ­veis (se houver)               â”‚\nâ”‚ â€¢ Formata resposta                                 â”‚\nâ”‚ â€¢ Log success                                      â”‚\nâ”‚ â€¢ Retorna apenas dados de negÃ³cio (sem token)      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n           â”‚ 200 OK\n           â”‚ { success: true,\n           â”‚   data: \"OlÃ¡! Como posso ajudar?\" }\n           â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ useChat Hook (recebe resposta)                     â”‚\nâ”‚ â€¢ Extrai dados                                     â”‚\nâ”‚ â€¢ Cria message object                              â”‚\nâ”‚ â€¢ Adiciona ao store                                â”‚\nâ”‚ â€¢ Atualiza loading state (false)                   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n           â”‚\n           â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ React Re-render (subscription ao store)            â”‚\nâ”‚ â€¢ MessageList renderiza nova mensagem do assistant â”‚\nâ”‚ â€¢ UI atualiza em real-time                        â”‚\nâ”‚ â€¢ Scroll para Ãºltima mensagem                      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n           â”‚\n           â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ User Sees Response  â”‚\nâ”‚ \"OlÃ¡! Como...\"      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\n## ğŸ¨ DecisÃµes ArquitetÃ´nicas\n\n### 1. **Por que Next.js 14+?**\n\nâœ… **App Router moderno** - File-based routing com server/client components  \nâœ… **API Routes serverless** - Backend sem infraestrutura extra  \nâœ… **TypeScript nativo** - Type safety por padrÃ£o  \nâœ… **Suporte React 18+** - Concurrent rendering, suspense, streaming  \nâœ… **Deployment Vercel** - Zero-config, auto-scaling, preview deployments  \n\n### 2. **Por que Zustand para State Management?**\n\nâœ… **Minimalista** - ~2KB, sem boilerplate  \nâœ… **Reatividade automÃ¡tica** - NÃ£o precisa de selectors complexos  \nâœ… **Middleware support** - Logging, persistence, devtools  \nâœ… **TypeScript first** - Tipos inferenciais automÃ¡ticos  \n\n### 3. **Por que Backend Gateway (/api/chat)?**\n\nâœ… **SeguranÃ§a de token** - Credenciais nunca expostas ao client  \nâœ… **Rate limiting centralizado** - ProteÃ§Ã£o contra abuso  \nâœ… **Audit trail** - Rastrear todas as operaÃ§Ãµes  \nâœ… **ValidaÃ§Ã£o server-side** - NÃ£o confiar em dados do client  \nâœ… **Escalabilidade** - Serverless functions escalam automaticamente  \n\n### 4. **Por que Vercel?**\n\nâœ… **Next.js optimizado** - Deploy nativo, zero-config  \nâœ… **Serverless automÃ¡tico** - Escala de 0 a 1000 req/s  \nâœ… **Environment variables seguras** - NÃ£o expostas ao client  \nâœ… **GitHub integration** - Deploy automÃ¡tico via push  \nâœ… **Preview deployments** - Testar PRs antes de merge  \nâœ… **Observability built-in** - Logs, metrics, traces  \n\n---\n\n## ğŸ› ï¸ Stack TecnolÃ³gico\n\n```json\n{\n  \"runtime\": {\n    \"node\": \"18.17.0+\",\n    \"npm\": \"9.0.0+\"\n  },\n  \"frontend\": {\n    \"framework\": \"Next.js 14.0+\",\n    \"ui_library\": \"React 18.0+\",\n    \"styling\": \"Tailwind CSS 3.0+\",\n    \"state_management\": \"Zustand 4.0+\",\n    \"data_fetching\": \"TanStack Query 5.0+\",\n    \"form_handling\": \"React Hook Form 7.0+\",\n    \"validation\": \"Zod 3.0+\"\n  },\n  \"backend\": {\n    \"runtime\": \"Node.js (Vercel Functions)\",\n    \"api_framework\": \"Next.js API Routes\",\n    \"rate_limiting\": \"custom-implementation\",\n    \"logging\": \"structured-logging (winston/pino)\",\n    \"cache\": \"memory-cache / redis\"\n  },\n  \"testing\": {\n    \"unit_testing\": \"Jest 29.0+\",\n    \"component_testing\": \"React Testing Library\",\n    \"e2e_testing\": \"Playwright / Cypress\",\n    \"bdd\": \"Behave / Cucumber\"\n  },\n  \"tooling\": {\n    \"code_linting\": \"ESLint 8.0+\",\n    \"code_formatting\": \"Prettier 3.0+\",\n    \"type_checking\": \"TypeScript 5.0+\",\n    \"version_control\": \"Git\",\n    \"ci_cd\": \"GitHub Actions\",\n    \"deployment\": \"Vercel\"\n  },\n  \"observability\": {\n    \"error_tracking\": \"Sentry\",\n    \"metrics\": \"Prometheus / Datadog\",\n    \"logging\": \"ELK Stack / Datadog\",\n    \"tracing\": \"OpenTelemetry (optional)\"\n  }\n}\n```\n\n---\n\n## ğŸ” SeguranÃ§a & Compliance\n\n### Matriz de AmeaÃ§as & MitigaÃ§Ãµes\n\n| AmeaÃ§a | Risco | MitigaÃ§Ã£o | Status |\n|--------|-------|-----------|--------|\n| **Token Exposure** | CRÃTICO | Gateway `/api/chat` com token em env var | âœ… |\n| **MITM Attack** | ALTO | HTTPS em todas as conexÃµes | âœ… |\n| **Rate Limiting** | ALTO | Token bucket (10 req/min por IP) | âœ… |\n| **XSS Attack** | ALTO | Input sanitization + CSP headers | âœ… |\n| **SQL Injection** | N/A | NÃ£o aplicÃ¡vel (stateless API) | âœ… |\n| **CSRF Attack** | MÃ‰DIO | SameSite cookies + origin validation | âœ… |\n| **DDoS Attack** | MÃ‰DIO | Vercel DDoS protection + rate limiting | âœ… |\n| **Data Breach** | CRÃTICO | Audit logging + encryption at rest | âœ… |\n\n### Security Headers Implementados\n\n```typescript\n// next.config.js\nconst securityHeaders = [\n  {\n    key: 'X-Content-Type-Options',\n    value: 'nosniff',\n  },\n  {\n    key: 'X-Frame-Options',\n    value: 'DENY',\n  },\n  {\n    key: 'X-XSS-Protection',\n    value: '1; mode=block',\n  },\n  {\n    key: 'Referrer-Policy',\n    value: 'strict-origin-when-cross-origin',\n  },\n  {\n    key: 'Permissions-Policy',\n    value: 'camera=(), microphone=(), geolocation=()',\n  },\n  {\n    key: 'Content-Security-Policy',\n    value: \"default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'\",\n  },\n];\n```\n\n### OWASP Top 10 Compliance\n\n```\nâœ… A01:2021 - Broken Access Control\n   â†’ JWT validation, rate limiting, audit logging\n\nâœ… A02:2021 - Cryptographic Failures\n   â†’ HTTPS only, secure token storage, HTTPS headers\n\nâœ… A03:2021 - Injection\n   â†’ Input validation, parameterized queries (N/A), output encoding\n\nâœ… A04:2021 - Insecure Design\n   â†’ Threat modeling, secure by default architecture\n\nâœ… A05:2021 - Security Misconfiguration\n   â†’ Security headers, no debug mode in prod, env var management\n\nâœ… A06:2021 - Vulnerable Components\n   â†’ Dependency scanning (npm audit), lock files, automated updates\n\nâœ… A07:2021 - Authentication Failures\n   â†’ Strong session management, password policies (N/A)\n\nâœ… A08:2021 - Software/Data Integrity Failures\n   â†’ Signed commits, secure dependencies, integrity checks\n\nâœ… A09:2021 - Logging & Monitoring\n   â†’ Comprehensive audit logging, error tracking, metrics collection\n\nâœ… A10:2021 - SSRF\n   â†’ URL validation, whitelist external APIs, no server-side includes\n```\n\n---\n\n## âš¡ Performance & OtimizaÃ§Ãµes\n\n### Web Vitals Targets\n\n```\nğŸ“Š Core Web Vitals\nâ”œâ”€ LCP (Largest Contentful Paint): < 2.5s\nâ”œâ”€ FID (First Input Delay): < 100ms\nâ”œâ”€ CLS (Cumulative Layout Shift): < 0.1\nâ””â”€ TTFB (Time to First Byte): < 600ms\n\nğŸ“ˆ Performance Budget\nâ”œâ”€ JavaScript (initial): < 100KB gzipped\nâ”œâ”€ CSS (initial): < 50KB gzipped\nâ”œâ”€ Images: < 1MB total (lazy-loaded)\nâ””â”€ Fonts: < 100KB total (system fonts preferred)\n```\n\n### OtimizaÃ§Ãµes Implementadas\n\n```typescript\n// 1. Code Splitting\nimport dynamic from 'next/dynamic';\nconst ChatWindow = dynamic(() => import('@/components/ChatWindow'), {\n  loading: () => <div>Loading...</div>,\n});\n\n// 2. Image Optimization\nimport Image from 'next/image';\n<Image\n  src=\"/avatar.png\"\n  alt=\"Avatar\"\n  width={40}\n  height={40}\n  priority={false}\n  quality={75}\n/>\n\n// 3. Server Components (by default in App Router)\n// Only client components marked with 'use client'\nexport default async function ChatPage() {\n  const initialMessages = await fetchMessages(); // Server-side\n  return <ChatWindow initialMessages={initialMessages} />;\n}\n\n// 4. Cache Strategy\n// Static generation for pages (unless dynamic)\n// Incremental Static Regeneration (ISR)\n// On-demand ISR with revalidation\n\n// 5. Database Query Optimization\n// Connection pooling\n// Query result caching\n// N+1 query prevention\n```\n\n---\n\n## ğŸš€ DevOps & CI/CD\n\n### GitHub Actions Workflows\n\n```yaml\n# .github/workflows/deploy.yml\nname: Deploy to Vercel\non:\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n      - uses: actions/setup-node@v3\n        with:\n          node-version: '18'\n      - run: npm install\n      - run: npm run lint\n      - run: npm run test\n      - run: npm run build\n      - uses: amondnet/vercel-action@v25\n        with:\n          vercel-token: ${{ secrets.VERCEL_TOKEN }}\n```\n\n### Environment Variables\n\n```bash\n# .env.example\nNATION_API_URL=https://api.nation.fun\nNATION_TOKEN=your_token_here  # Only in Vercel env vars\nNEXT_PUBLIC_API_URL=https://yourdomain.vercel.app\nNODE_ENV=production\nLOG_LEVEL=info\n```\n\n---\n\n## ğŸ§ª Testes & Qualidade\n\n### Teste Pyramid\n\n```\n           /\\\n          /  \\\n         / E2E \\\n        /________\\\n       /\\        /\\\n      /  \\ Inte /  \\\n     / Int / gr /    \\\n    /____/____/____ \\\n   /\\              /\\\n  /  \\    Unit   /  \\\n / Unit \\______ /    \\\n/________________\\\n\nTarget Coverage:\nâ”œâ”€ Unit tests: 80%\nâ”œâ”€ Integration: 50%\nâ”œâ”€ E2E: Key user flows\nâ””â”€ Total: 75%+\n```\n\n### Jest Configuration\n\n```typescript\n// jest.config.js\nmodule.exports = {\n  preset: 'ts-jest',\n  testEnvironment: 'jsdom',\n  roots: ['<rootDir>'],\n  testMatch: ['**/__tests__/**/*.test.ts', '**/__tests__/**/*.test.tsx'],\n  moduleNameMapper: {\n    '^@/(.*)$': '<rootDir>/$1',\n  },\n  collectCoverageFrom: [\n    'app/**/*.ts',\n    'lib/**/*.ts',\n    'hooks/**/*.ts',\n    '!**/*.d.ts',\n    '!**/node_modules/**',\n  ],\n};\n```\n\n### BDD Feature Files\n\n```gherkin\n# features/chat-security.feature\nFeature: Chat with Security\n  Scenario: User sends message securely\n    Given user is on chat page\n    When user types message\n    And clicks send button\n    Then message is sent to /api/chat\n    And response is displayed\n    And token is never exposed in browser\n```\n\n---\n\n## ğŸ“¡ DocumentaÃ§Ã£o API\n\n### Endpoint: POST /api/chat\n\n**Request:**\n```typescript\ninterface ChatRequest {\n  message: string; // Required, max 5000 chars\n}\n```\n\n**Response (200 OK):**\n```typescript\ninterface ChatResponse {\n  success: true;\n  data: {\n    id: string;\n    content: string;\n    timestamp: string;\n  };\n}\n```\n\n**Response (400 Bad Request):**\n```typescript\ninterface ErrorResponse {\n  error: string; // \"Invalid message\" | \"Message too long\" | etc.\n}\n```\n\n**Response (429 Too Many Requests):**\n```typescript\ninterface RateLimitResponse {\n  error: string;\n  retryAfter: number; // seconds\n}\n```\n\n**cURL Example:**\n```bash\ncurl -X POST https://yourdomain.vercel.app/api/chat \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"message\": \"OlÃ¡, como vocÃª estÃ¡?\"}'\n```\n\n---\n\n## ğŸ“Š MÃ©tricas & Monitoramento\n\n### KPIs Monitorados\n\n```typescript\ninterface MetricsCollected {\n  // Performance\n  apiLatency: number; // ms\n  requestsPerSecond: number;\n  errorRate: number; // %\n  \n  // Business\n  messagesPerUser: number;\n  activeUsers: number;\n  conversionRate: number; // %\n  \n  // Technical\n  serverUptime: number; // %\n  deploymentFrequency: number; // per week\n  meanTimeToRecovery: number; // hours\n}\n```\n\n### Observability Stack\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Application     â”‚\nâ”‚ (structured logs)â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n         â”‚\n         â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Sentry          â”‚â”€â”€â”€â†’   â”‚ Error Tracking   â”‚\nâ”‚ (error tracking)â”‚       â”‚ & Alerting       â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n         â–²\n         â”‚\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                         â”‚                     â”‚\nâ–¼                         â–¼                     â–¼\nPrometheus         Datadog Logs         Grafana Dashboards\n(metrics)          (centralized)        (visualization)\n```\n\n---\n\n## ğŸ¯ Roadmap Futuro\n\n### Phase 1 (Current - Q4 2025)\n- âœ… Chat endpoint seguro\n- âœ… Frontend app\n- âœ… Rate limiting bÃ¡sico\n- âœ… Audit logging\n\n### Phase 2 (Q1 2026)\n- ğŸ“‹ User authentication (NextAuth.js)\n- ğŸ“‹ Conversation persistence (DB)\n- ğŸ“‹ Advanced rate limiting (Redis)\n- ğŸ“‹ Observability avanÃ§ada (Datadog)\n\n### Phase 3 (Q2 2026)\n- ğŸ“‹ Analytics dashboard\n- ğŸ“‹ Admin panel\n- ğŸ“‹ API versioning\n- ğŸ“‹ Webhooks\n\n### Phase 4 (Q3 2026)\n- ğŸ“‹ Multi-language support\n- ğŸ“‹ Custom models\n- ğŸ“‹ Batch processing\n- ğŸ“‹ Export features\n\n---\n\n## ğŸ¤ Contribuindo\n\nVer `CONTRIBUTING.md` para diretrizes de desenvolvimento.\n\n## ğŸ“„ LicenÃ§a\n\nMIT License - veja LICENSE.md\n\n---\n\n**Ãšltima atualizaÃ§Ã£o:** 29 de novembro de 2025  \n**ResponsÃ¡vel:** Engineering Team  \n**Status:** Production Ready âœ…\n